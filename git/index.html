<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <title>git/README.md</title>
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
  </style>

<style>
  .markdown-body {
    box-sizing: border-box;
    min-width: 200px;
    max-width: 980px;
    margin: 0 auto;
    padding: 45px;
  }
  p.caption{
    display:none;
  }
  img {width: 100%}

  @media (max-width: 767px) {
    .markdown-body {
      padding: 15px;
    }
  }
</style>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://kaityo256.github.io/sevendayshpc/github-markdown.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<article class="markdown-body">
<h1 id="gitのインストールと動作確認">Gitのインストールと動作確認</h1>
<h2 id="gitについて">Gitについて</h2>
<p>まず、以下のスライドを見よ。</p>
<p><a href="https://speakerdeck.com/kaityo256/starting-git">数値計算屋のためのGit入門</a></p>
<p>今後、「どのファイルがどんな状態にあるか」「歴史はどうなっているか」をイメージしながらGitを操作すると良い。</p>
<h2 id="gitのインストール">Gitのインストール</h2>
<h3 id="windows">Windows</h3>
<p>WSL2のUbuntuを使う。</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" title="1"><span class="fu">sudo</span> apt update</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="fu">sudo</span> apt install git</a></code></pre></div>
<p>を実行せよ。インストールが完了したら、</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb2-1" title="1"><span class="fu">git</span> --version</a></code></pre></div>
<p>を実行せよ。</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode txt"><code class="sourceCode default"><a class="sourceLine" id="cb3-1" title="1">git version 2.25.1</a></code></pre></div>
<p>と表示されればインストール完了である。</p>
<h3 id="mac">Mac</h3>
<p>Macの場合は、Homebrewからインストールする。ターミナルから</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb4-1" title="1"><span class="ex">brew</span> update</a>
<a class="sourceLine" id="cb4-2" title="2"><span class="ex">brew</span> install git</a></code></pre></div>
<p>を実行せよ。インストールが完了したら、</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb5-1" title="1"><span class="fu">git</span> --version</a></code></pre></div>
<p>を実行せよ。</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode txt"><code class="sourceCode default"><a class="sourceLine" id="cb6-1" title="1">git version 2.26.0</a></code></pre></div>
<p>と表示されればインストール完了である。</p>
<h3 id="デフォルトブランチについて">デフォルトブランチについて</h3>
<p>Gitのデフォルトブランチは<code>master</code>という名前だが、これを<code>main</code>に変えようという動きがある。また、GitHubではすでにデフォルトブランチが<code>main</code>になっている。これをうけて、Git 2.28より、デフォルトブランチを指定できるようになった。デフォルトブランチを<code>main</code>に変更する場合は以下を実行する。</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb7-1" title="1"><span class="fu">git</span> config --global init.defaultBranch main</a></code></pre></div>
<p>ただし、現時点(2020年3月31日)でUbuntuで入るGitが2.25.1なので、以下はデフォルトブランチが<code>master</code>のままで作業する。</p>
<h2 id="gitの初期設定">Gitの初期設定</h2>
<p>Gitのインストールが完了したら、「ユーザ名」と「メールアドレス」の設定を行う。ユーザ名とメールアドレスは、GitHub等で公開リポジトリを作った場合には誰からも見られる状態となることに注意。</p>
<p>ターミナルで以下を実行する。</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb8-1" title="1"><span class="fu">git</span> config --global user.name <span class="st">&quot;ユーザー名&quot;</span></a>
<a class="sourceLine" id="cb8-2" title="2"><span class="fu">git</span> config --global user.email <span class="st">&quot;メールアドレス&quot;</span></a></code></pre></div>
<p>特にこだわりがなければ、ユーザ名は自分の英語名(私は “H. Watanabe”にしている)、メールアドレスは普段使うメールアドレスにしておけば良い(携帯のアドレスなどは避けること)。</p>
<p>上記の設定は<code>.gitconfig</code>に保存される。保存されたか見てみよう。以下を実行せよ。</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb9-1" title="1"><span class="fu">cat</span> .gitconfig</a></code></pre></div>
<p>以下のように表示されれば設定されている。</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode txt"><code class="sourceCode default"><a class="sourceLine" id="cb10-1" title="1">[user]</a>
<a class="sourceLine" id="cb10-2" title="2">        name = 先ほど設定したユーザー名</a>
<a class="sourceLine" id="cb10-3" title="3">        email = 先ほど設定したメールアドレス</a></code></pre></div>
<p>また、よく使うコマンドの省略形(エイリアス)も登録しておこう。とりあえず一つだけ設定してみよう。</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb11-1" title="1"><span class="fu">git</span> config --global alias.st <span class="st">&quot;status -s&quot;</span></a></code></pre></div>
<p>これは、デフォルトの<code>git status</code>は情報過多のため、短い形式で表示させる<code>git status -s</code>を多用するので、それを<code>git st</code>として実行できるように登録したものだ。このあたりは完全に趣味なので、慣れてきたら自分好みに追加・削除・修正していくと良い。ここまでの設定で、<code>.gitconfig</code>は以下のようになったはずだ。</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode txt"><code class="sourceCode default"><a class="sourceLine" id="cb12-1" title="1">[user]</a>
<a class="sourceLine" id="cb12-2" title="2">        name = 先ほど設定したユーザー名</a>
<a class="sourceLine" id="cb12-3" title="3">        email = 先ほど設定したメールアドレス</a>
<a class="sourceLine" id="cb12-4" title="4">[alias]</a>
<a class="sourceLine" id="cb12-5" title="5">        st = status -s</a></code></pre></div>
<p>また、UbuntuのデフォルトエディタはGNU Nanoになっており、正直使いづらいのでVimにしておこう。</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb13-1" title="1"><span class="fu">git</span> config --global core.editor vim</a></code></pre></div>
<p><code>.gitconfig</code>は以下のようになったはずだ。</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode txt"><code class="sourceCode default"><a class="sourceLine" id="cb14-1" title="1">[user]</a>
<a class="sourceLine" id="cb14-2" title="2">        name = 先ほど設定したユーザー名</a>
<a class="sourceLine" id="cb14-3" title="3">        email = 先ほど設定したメールアドレス</a>
<a class="sourceLine" id="cb14-4" title="4">[alias]</a>
<a class="sourceLine" id="cb14-5" title="5">        co = checkout</a>
<a class="sourceLine" id="cb14-6" title="6">        st = status -s</a>
<a class="sourceLine" id="cb14-7" title="7">        ci = commit -a</a>
<a class="sourceLine" id="cb14-8" title="8">[core]</a>
<a class="sourceLine" id="cb14-9" title="9">  editor = vim</a></code></pre></div>
<p>これでGitの利用準備が整った。</p>
<h2 id="gitの動作確認">Gitの動作確認</h2>
<p>それでは、実際にGitを使ってリポジトリを作成し、基本的な操作を学んでみよう。最初にコマンドラインから、次にVSCode上から操作する。今後、コマンドライン、VSCodeどちらでGitを利用しても良いが、コマンドラインから使えるようになることを推奨する。</p>
<p>途中、わけがわからなくなったら、ディレクトリごと消してやり直すこと。</p>
<h3 id="リポジトリの作成">リポジトリの作成</h3>
<p>まず、適当なテスト用ディレクトリを作り、その中で作業しよう。<code>git</code>というディレクトリを作り、さらにその中に<code>test</code>というディレクトリを作ろう。</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb15-1" title="1"><span class="bu">cd</span></a>
<a class="sourceLine" id="cb15-2" title="2"><span class="fu">mkdir</span> git</a>
<a class="sourceLine" id="cb15-3" title="3"><span class="bu">cd</span> git</a>
<a class="sourceLine" id="cb15-4" title="4"><span class="fu">mkdir</span> test</a>
<a class="sourceLine" id="cb15-5" title="5"><span class="bu">cd</span> test</a></code></pre></div>
<p>最初に<code>cd</code>とだけ入力しているのは、ホームディレクトリに戻るためだ。</p>
<p>ディレクトリ<code>test</code>の中に、<code>README.md</code>というファイルを作成しよう。まず、このディレクトリでVSCodeを起動する。</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb16-1" title="1"><span class="ex">code</span> .</a></code></pre></div>
<p>VSCodeが開いたら、左のエクスプローラーの「TEST」の右にある「新しいファイル」ボタンを押して、<code>README.md</code>と入力しよう。</p>
<figure>
<img src="fig/vscode_newfile.png" alt="新しいファイル" /><figcaption>新しいファイル</figcaption>
</figure>
<p><code>README.md</code>ファイルが開かれたら、</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode md"><code class="sourceCode markdown"><a class="sourceLine" id="cb17-1" title="1"><span class="fu"># Test</span></a></code></pre></div>
<p>とだけ入力し、保存しよう。これで、以下のようなディレクトリ構成になったはずだ。</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode txt"><code class="sourceCode default"><a class="sourceLine" id="cb18-1" title="1">git</a>
<a class="sourceLine" id="cb18-2" title="2">└── test</a>
<a class="sourceLine" id="cb18-3" title="3">    └── README.md</a></code></pre></div>
<p>この状態でターミナルに戻り、リポジトリとして初期化しよう。</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb19-1" title="1"><span class="fu">git</span> init</a></code></pre></div>
<p>すると、<code>.git</code>というディレクトリが作成され、<code>test</code>ディレクトリがリポジトリとして初期化される。以下を実行してみよ。</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb20-1" title="1"><span class="fu">ls</span> -la</a></code></pre></div>
<p><code>README.md</code>に加え、<code>.git</code>というディレクトリが作成されたことがわかるはずだ。</p>
<p><code>git init</code>した直後は、「現在のディレクトリ<code>test</code>をGitで管理することは決まったが、まだGitはどのファイルも管理していない」という状態になる。</p>
<figure>
<img src="fig/git_init.png" alt="git init直後" /><figcaption>git init直後</figcaption>
</figure>
<p>この状態を確認してみよう。ターミナルで以下を実行せよ。</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb21-1" title="1"><span class="fu">git</span> status</a></code></pre></div>
<p>以下のような表示が得られるはずである。なお、環境変数<code>LANG</code>が日本語になっていると、日本語のメッセージが表示される。</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode txt"><code class="sourceCode default"><a class="sourceLine" id="cb22-1" title="1">On branch master</a>
<a class="sourceLine" id="cb22-2" title="2"></a>
<a class="sourceLine" id="cb22-3" title="3">No commits yet</a>
<a class="sourceLine" id="cb22-4" title="4"></a>
<a class="sourceLine" id="cb22-5" title="5">Untracked files:</a>
<a class="sourceLine" id="cb22-6" title="6">  (use &quot;git add &lt;file&gt;...&quot; to include in what will be committed)</a>
<a class="sourceLine" id="cb22-7" title="7">        README.md</a>
<a class="sourceLine" id="cb22-8" title="8"></a>
<a class="sourceLine" id="cb22-9" title="9">nothing added to commit but untracked files present (use &quot;git add&quot; to track)</a></code></pre></div>
<p>これは、まだ何もコミットがされておらず、<code>README.md</code>というファイルが<code>Untracked</code>、つまりGitの管理下に置かれていないことを表している。</p>
<p>状態を見るのにいちいちこんな長いメッセージを見せられても困るので、<code>-s</code>オプションをつけて見よう。</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb23-1" title="1"><span class="fu">git</span> status -s</a></code></pre></div>
<p>こんな表示が出力されたはずだ。</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb24-1" title="1"><span class="ex">??</span> README.md</a></code></pre></div>
<p><code>??</code>というのは、<code>Untracked</code>、つまりGitの管理下に無いよ、という意味だ。いちいち<code>git status -s</code>と入力するのは面倒なので、最初に<code>status -s</code>に<code>st</code>という別名をつけておいた。</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb25-1" title="1"><span class="fu">git</span> st</a></code></pre></div>
<p>と入力すると、<code>git status -s</code>と入力したのと同じことになる。以後、こっちを使うことにしよう。</p>
<h3 id="インデックスへの追加">インデックスへの追加</h3>
<p>さて、<code>Untracked</code>な状態のファイルを、Gitの管理下に置こう。そのためには、<code>git add</code>を実行する。</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb26-1" title="1"><span class="fu">git</span> add README.md</a></code></pre></div>
<p>現在の状態を見てみよう。</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb27-1" title="1"><span class="fu">git</span> st</a></code></pre></div>
<p>こんな表示になるはずだ。</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode txt"><code class="sourceCode default"><a class="sourceLine" id="cb28-1" title="1">A  README.md</a></code></pre></div>
<p>これは「<code>README.md</code>が追加されることが予約されたよ」という意味で、インデックスに<code>README.md</code>が追加された状態になっている。</p>
<figure>
<img src="fig/git_index.png" alt="インデックス" /><figcaption>インデックス</figcaption>
</figure>
<p>では、記念すべき最初のコミットをしよう。Gitはコミットをする時に、コミットメッセージが必要となる。最初のメッセージは慣例により<code>initial commit</code>とすることが多い。</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb29-1" title="1"><span class="fu">git</span> commit -m <span class="st">&quot;initial commit&quot;</span></a></code></pre></div>
<p>これによりコミットが作成され、<code>README.md</code>はGitの管理下に入った。</p>
<figure>
<img src="fig/git_commit.png" alt="git commit" /><figcaption>git commit</figcaption>
</figure>
<p>状態を見てみよう。</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb30-1" title="1"><span class="fu">git</span> st</a></code></pre></div>
<p>何も表示されないはずである。ロングバージョンのステータスも見てみよう。</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb31-1" title="1">$ <span class="fu">git</span> status</a>
<a class="sourceLine" id="cb31-2" title="2"><span class="ex">On</span> branch master</a>
<a class="sourceLine" id="cb31-3" title="3"><span class="ex">nothing</span> to commit, working tree clean</a></code></pre></div>
<p>なお、このように<code>$ コマンド名</code>の表記がある場合は、<code>$</code>以後だけを入力して実行したら、行頭に<code>$</code>がついていないような表記が出力された、という意味である。今後、<code>$</code>がついている場所のコマンドを<code>$</code>抜きで入力すること。</p>
<p>自分がいま<code>master</code>ブランチにいて、何もコミットをする必要がなく、ワーキングツリーがきれい(clean)、つまりリポジトリが記憶している最新のコミットと一致していることを意味している。</p>
<h3 id="ファイルの修正">ファイルの修正</h3>
<p>では、ファイルを修正してみよう。VSCodeで<code>README.md</code>に行を付け加えて保存しよう。</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode txt"><code class="sourceCode default"><a class="sourceLine" id="cb32-1" title="1"># Test</a>
<a class="sourceLine" id="cb32-2" title="2"></a>
<a class="sourceLine" id="cb32-3" title="3">Hello git</a></code></pre></div>
<p><code>Hello git</code>の最後の改行を忘れないように。</p>
<p>状態を見てみよう。</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb33-1" title="1">$ <span class="fu">git</span> st</a>
<a class="sourceLine" id="cb33-2" title="2"> <span class="ex">M</span> README.md</a></code></pre></div>
<p>ファイル名の前に<code>M</code>という文字がついた。これは<code>Modified</code>の頭文字で、「リポジトリが知っている状態から修正されているよ」という意味だ。</p>
<figure>
<img src="fig/git_modified.png" alt="git modified" /><figcaption>git modified</figcaption>
</figure>
<p>また、この状態で<code>git diff</code>を実行してみよう。</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode txt"><code class="sourceCode default"><a class="sourceLine" id="cb34-1" title="1">$ git diff</a>
<a class="sourceLine" id="cb34-2" title="2">diff --git a/README.md b/README.md</a>
<a class="sourceLine" id="cb34-3" title="3">index 8ae0569..58c814b 100644</a>
<a class="sourceLine" id="cb34-4" title="4">--- a/README.md</a>
<a class="sourceLine" id="cb34-5" title="5">+++ b/README.md</a>
<a class="sourceLine" id="cb34-6" title="6">@@ -1 +1,3 @@</a>
<a class="sourceLine" id="cb34-7" title="7"> # Test</a>
<a class="sourceLine" id="cb34-8" title="8">+</a>
<a class="sourceLine" id="cb34-9" title="9">+Hello git</a></code></pre></div>
<p><code>git diff</code>は、何もオプションをつけずに実行すると、</p>
<ul>
<li>現在のブランチで</li>
<li>リポジトリに記録されている最新の状態から</li>
<li>修正のあった全てのファイルについて</li>
</ul>
<p>差分を表示する。</p>
<p>行頭に<code>+</code>がついた箇所が追加された行である。</p>
<p>この修正をリポジトリに教えるために、<code>git add</code>しよう。</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb35-1" title="1"><span class="fu">git</span> add README.md</a></code></pre></div>
<p>また、状態を見てみよう。</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb36-1" title="1">$ <span class="fu">git</span> st</a>
<a class="sourceLine" id="cb36-2" title="2"><span class="ex">M</span>  README.md</a></code></pre></div>
<p>先ほどは赤字で二桁目に<code>M</code>が表示されていたのが、今回は緑字で一桁目に<code>M</code>が表示されているはずである。これは、修正されたファイルがインデックスに追加されたことを示す。</p>
<figure>
<img src="fig/git_modified_add.png" alt="git add" /><figcaption>git add</figcaption>
</figure>
<p>この状態でコミットしよう。</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb37-1" title="1"><span class="fu">git</span> commit -m <span class="st">&quot;adds new line&quot;</span></a></code></pre></div>
<p><code>-m</code>以後がコミットメッセージだ。日本語も使えるが、文字化けする可能性があるので、とりあえず英語で書いておいた方が良い。</p>
<p>修正がリポジトリに登録され、ワーキングツリーがきれい(clean)な状態となった。</p>
<figure>
<img src="fig/git_modified_commit.png" alt="git commit" /><figcaption>git commit</figcaption>
</figure>
<h3 id="git-addなしのコミット">git addなしのコミット</h3>
<p>Gitでは、原則として</p>
<ul>
<li>ファイルを修正する</li>
<li><code>git add</code>でコミットするファイルをインデックスに登録する</li>
<li><code>git commit</code>でリポジトリに反映する</li>
</ul>
<p>という作業を繰り返す。実際、多人数で開発する場合はこうして「きれいな歴史」を作る方が良いのだが、当面は一人で開発するので、<code>git add</code>を省略して良い。</p>
<p><code>git add</code>を省略するには、コミットする時に<code>git commit -a</code>オプションをつけて、「修正されたファイル全てをコミットする」ようにすれば良い。先ほど<code>commit -a</code>に<code>ci</code>という別名(エイリアス)をつけたので、今後はそれを使うことにしよう。</p>
<p>まず、VSCodeでさらにファイルを修正しよう。<code>README.md</code>に以下の行を付け加えよう。やはり最後の改行を忘れないように。</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode txt"><code class="sourceCode default"><a class="sourceLine" id="cb38-1" title="1"># Test</a>
<a class="sourceLine" id="cb38-2" title="2"></a>
<a class="sourceLine" id="cb38-3" title="3">Hello git</a>
<a class="sourceLine" id="cb38-4" title="4">Bye git</a></code></pre></div>
<p>この状態で、<code>git add</code>せずに<code>git commit</code>しようとすると、「何をコミットするか指定が無いよ(インデックスに何も無いよ)」と怒られる。</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb39-1" title="1">$ <span class="fu">git</span> commit -m <span class="st">&quot;modifies README.md&quot;</span></a>
<a class="sourceLine" id="cb39-2" title="2"><span class="ex">On</span> branch master</a>
<a class="sourceLine" id="cb39-3" title="3"><span class="ex">Changes</span> not staged for commit:</a>
<a class="sourceLine" id="cb39-4" title="4">  <span class="kw">(</span><span class="ex">use</span> <span class="st">&quot;git add &lt;file&gt;...&quot;</span> to update what will be committed<span class="kw">)</span></a>
<a class="sourceLine" id="cb39-5" title="5">  <span class="kw">(</span><span class="ex">use</span> <span class="st">&quot;git restore &lt;file&gt;...&quot;</span> to discard changes in working directory<span class="kw">)</span></a>
<a class="sourceLine" id="cb39-6" title="6">        <span class="ex">modified</span>:   README.md</a>
<a class="sourceLine" id="cb39-7" title="7"></a>
<a class="sourceLine" id="cb39-8" title="8"><span class="ex">no</span> changes added to commit (use <span class="st">&quot;git add&quot;</span> and/or <span class="st">&quot;git commit -a&quot;</span>)</a></code></pre></div>
<p>上記メッセージには、まず<code>git add</code>するか、<code>git commit -a</code>しろとあるので、ここでは後者を実行しよう。先程<code>git commit -a</code>に<code>git ci</code>という別名をつけたので、<code>git ci</code>を使えば<code>git add</code>なしにいきなりコミットできる。</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb40-1" title="1"><span class="fu">git</span> ci -m <span class="st">&quot;modifies README.md&quot;</span></a></code></pre></div>
<p>以後、慣れるまでは場合は<code>git ci</code>を使うことで<code>git add</code>を省略して良い。</p>
<h3 id="歴史の確認">歴史の確認</h3>
<p>これまでの歴史を確認して見よう。上記の通りに作業して来たなら、3つのコミットが作成されたはずだ。<code>git log</code>で歴史を振り返ってみよう。</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb41-1" title="1">$ <span class="fu">git</span> log</a>
<a class="sourceLine" id="cb41-2" title="2"><span class="ex">commit</span> e63355285c9fd1929925568522dbc321e9b3e8c7 (HEAD -<span class="op">&gt;</span> master)</a>
<a class="sourceLine" id="cb41-3" title="3"><span class="ex">Author</span>: H. Watanabe <span class="op">&lt;</span>kaityo@users.sourceforge.jp<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb41-4" title="4"><span class="ex">Date</span>:   Wed Mar 31 12:01:12 2021 +0900</a>
<a class="sourceLine" id="cb41-5" title="5"></a>
<a class="sourceLine" id="cb41-6" title="6">    <span class="ex">modifies</span> README.md</a>
<a class="sourceLine" id="cb41-7" title="7"></a>
<a class="sourceLine" id="cb41-8" title="8"><span class="ex">commit</span> 2eb03e9589b263f4d2ab61b09644da49134d8e21</a>
<a class="sourceLine" id="cb41-9" title="9"><span class="ex">Author</span>: H. Watanabe <span class="op">&lt;</span>kaityo@users.sourceforge.jp<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb41-10" title="10"><span class="ex">Date</span>:   Wed Mar 31 11:38:38 2021 +0900</a>
<a class="sourceLine" id="cb41-11" title="11"></a>
<a class="sourceLine" id="cb41-12" title="12">    <span class="ex">adds</span> new line</a>
<a class="sourceLine" id="cb41-13" title="13"></a>
<a class="sourceLine" id="cb41-14" title="14"><span class="ex">commit</span> 85f4e334b0094170d4382c7a86e4a185f12e3cd1</a>
<a class="sourceLine" id="cb41-15" title="15"><span class="ex">Author</span>: H. Watanabe <span class="op">&lt;</span>kaityo@users.sourceforge.jp<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb41-16" title="16"><span class="ex">Date</span>:   Wed Mar 31 11:35:44 2021 +0900</a>
<a class="sourceLine" id="cb41-17" title="17"></a>
<a class="sourceLine" id="cb41-18" title="18">    <span class="ex">initial</span> commit</a></code></pre></div>
<p>いつ、誰が、どのコミットを作ったかが表示される。最初に設定した名前とメールアドレスはここに表示される。GitHubなどでpublicなリポジトリを作った場合、全世界に公開されるので注意。</p>
<p><code>commit</code>の後の英数字は「コミットハッシュ」と呼ばれ、コミットにつけられた識別子である。これは環境によって異なるため、同じ操作をしても異なるハッシュが作成される。</p>
<p>デフォルトの表示では見づらいので、一コミット一行で表示しても良い。</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb42-1" title="1">$ <span class="fu">git</span> log --oneline</a>
<a class="sourceLine" id="cb42-2" title="2"><span class="ex">e633552</span> (HEAD -<span class="op">&gt;</span> master) <span class="ex">modifies</span> README.md</a>
<a class="sourceLine" id="cb42-3" title="3"><span class="ex">2eb03e9</span> adds new line</a>
<a class="sourceLine" id="cb42-4" title="4"><span class="ex">85f4e33</span> initial commit</a></code></pre></div>
<p>個人的にはこちらの方が見やすいので、<code>l</code>を<code>log --oneline</code>のエイリアスにしてしまっても良いと思う。もしそうしたい場合は、</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb43-1" title="1"><span class="fu">git</span> config --global alias.l <span class="st">&quot;log --oneline&quot;</span></a></code></pre></div>
<p>を実行せよ。以後、</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb44-1" title="1"><span class="fu">git</span> l</a></code></pre></div>
<p>で、コンパクトなログを見ることができる。</p>
<h3 id="vscodeからの操作">VSCodeからの操作</h3>
<p>Gitは、VSCodeからも操作することができる。今、<code>README.md</code>を開いているVSCodeで何か修正して、保存してみよう。例えば以下のように行を追加する。</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode txt"><code class="sourceCode default"><a class="sourceLine" id="cb45-1" title="1"># Test</a>
<a class="sourceLine" id="cb45-2" title="2"></a>
<a class="sourceLine" id="cb45-3" title="3">Hello git</a>
<a class="sourceLine" id="cb45-4" title="4">Bye git</a>
<a class="sourceLine" id="cb45-5" title="5">Git from VSCode</a></code></pre></div>
<p>修正を保存した状態で左を見ると、「ソース管理」アイコンに「1」という数字が表示されているはずだ。これは「Gitで管理されているファイルのうち、一つのファイルが修正されているよ」という意味だ。</p>
<figure>
<img src="fig/vscode_giticon.png" alt="VSCode Git Icon" /><figcaption>VSCode Git Icon</figcaption>
</figure>
<p>この「ソース管理アイコン」をクリックしよう。</p>
<figure>
<img src="fig/vscode_add.png" alt="VSCode add" /><figcaption>VSCode add</figcaption>
</figure>
<p>すると、ソース管理ウィンドウが開き、「変更」の下に「README.md」がある。そのファイル名の右にある「+」マークをクリックしよう。<code>README.md</code>が「変更」から「ステージング済みの変更」に移動したはずだ。</p>
<figure>
<img src="fig/vscode_staged.png" alt="VSCode staged" /><figcaption>VSCode staged</figcaption>
</figure>
<p>これは、</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb46-1" title="1"><span class="fu">git</span> add README.md</a></code></pre></div>
<p>という操作をしたことと等価だ。</p>
<p>この状態で「メッセージ」のところにコミットメッセージを書いて、上の「チェックマーク」をクリックすると、コミットできる。例えばメッセージとして「commit from VSCode」と書いてコミットしてみよう。</p>
<figure>
<img src="fig/vscode_commit.png" alt="VSCode commit" /><figcaption>VSCode commit</figcaption>
</figure>
<p>これでコミットができた。ちゃんとコミットされたかどうか、ターミナルから確認してみよう。</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb47-1" title="1">$ <span class="fu">git</span> log --oneline</a>
<a class="sourceLine" id="cb47-2" title="2"><span class="ex">c67341b</span> (HEAD -<span class="op">&gt;</span> master) <span class="ex">commit</span> from VSCode</a>
<a class="sourceLine" id="cb47-3" title="3"><span class="ex">e633552</span> modifies README.md</a>
<a class="sourceLine" id="cb47-4" title="4"><span class="ex">2eb03e9</span> adds new line</a>
<a class="sourceLine" id="cb47-5" title="5"><span class="ex">85f4e33</span> initial commit</a></code></pre></div>
<p>VSCodeから作ったコミットが反映されていることがわかる。</p>
<p>基本的にVSCodeからGitの全ての操作を行うことができるが、当面の間はコマンドラインから実行した方が良い。慣れてきたらVSCodeその他のGUIツールを使うと良いだろう。</p>
<h2 id="マージと衝突の処理">マージと衝突の処理</h2>
<p>Gitでは、原則としてmaster/mainブランチでは作業をしない。通常は、ブランチを切って、作業はブランチ上で行い、master/mainブランチにはマージするのみ、とする運用を採用することが多い。</p>
<p>以下では、ブランチの切り方、マージの仕方、またマージに失敗(衝突)したときの対処方法をかんたんに見ておこう。</p>
<h3 id="ブランチの作成と切り替え">ブランチの作成と切り替え</h3>
<p>ブランチを作成するには、<code>git branch ブランチ名</code>とする。</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb48-1" title="1"><span class="fu">git</span> branch newbranch</a></code></pre></div>
<p><code>git branch</code>を実行すると、ブランチ一覧を見ることができる。</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb49-1" title="1">$ <span class="fu">git</span> branch</a>
<a class="sourceLine" id="cb49-2" title="2"><span class="ex">*</span> master</a>
<a class="sourceLine" id="cb49-3" title="3">  <span class="ex">newbranch</span></a></code></pre></div>
<p>ここで、<code>*</code>がついているブランチが、今見ているブランチ、すなわちHEADがついているブランチである。<code>git branch</code>でブランチを作成しても、「今見ているブランチ」は変更されないので注意。</p>
<p>ブランチを切り替えるには、<code>git checkout ブランチ名</code>を使う。我々は省略形<code>co</code>を定義しているのでそれを使っても良い。</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb50-1" title="1">$ <span class="fu">git</span> checkout newbranch</a>
<a class="sourceLine" id="cb50-2" title="2"><span class="ex">Switched</span> to branch <span class="st">&#39;newbranch&#39;</span></a></code></pre></div>
<p>ブランチ名はタブ補完も効くので適宜活用すること。</p>
<p>切り替わったかどうかを見てみよう。</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb51-1" title="1">$ <span class="fu">git</span> branch</a>
<a class="sourceLine" id="cb51-2" title="2">  <span class="ex">master</span></a>
<a class="sourceLine" id="cb51-3" title="3"><span class="ex">*</span> newbranch</a></code></pre></div>
<p><code>newbranch</code>に<code>*</code>がついていることがわかる。</p>
<p>ブランチを削除するには、<code>git branch -d ブランチ名</code>とする。「今見ているブランチ」は削除できないので、一度<code>master</code>に戻ってから削除しよう。</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb52-1" title="1"><span class="fu">git</span> checkout master</a>
<a class="sourceLine" id="cb52-2" title="2"><span class="fu">git</span> branch -d newbranch</a></code></pre></div>
<p>消えたか見てみよう。</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb53-1" title="1">$ <span class="fu">git</span> branch</a>
<a class="sourceLine" id="cb53-2" title="2"><span class="ex">*</span> master</a></code></pre></div>
<p>先程作成したブランチが消えた。</p>
<p>さて、ブランチを作成するとき、すぐにその作成したブランチに移りたいことの方が良い。ブランチの作成と、そのブランチへの切り替えを同時に行うには<code>git checkout -b ブランチ名</code>とする。</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb54-1" title="1">$ <span class="fu">git</span> checkout -b newbranch</a>
<a class="sourceLine" id="cb54-2" title="2"><span class="ex">Switched</span> to a new branch <span class="st">&#39;newbranch&#39;</span></a></code></pre></div>
<p>先程と異なり、「新しいブランチにスイッチしたよ」というメッセージが表示される。確認してみよう。</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb55-1" title="1">$ <span class="fu">git</span> branch</a>
<a class="sourceLine" id="cb55-2" title="2">  <span class="ex">master</span></a>
<a class="sourceLine" id="cb55-3" title="3"><span class="ex">*</span> newbranch</a></code></pre></div>
<p>新しいブランチが作成され、そのブランチにスイッチしていることがわかる。</p>
<h3 id="ブランチ上での作業">ブランチ上での作業</h3>
<p>まず、現在の状況を確認してみよう。</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb56-1" title="1">$ <span class="fu">git</span> log --oneline</a>
<a class="sourceLine" id="cb56-2" title="2"><span class="ex">c67341b</span> (HEAD -<span class="op">&gt;</span> newbranch, master) <span class="ex">commit</span> from VSCode</a>
<a class="sourceLine" id="cb56-3" title="3"><span class="ex">e633552</span> modifies README.md</a>
<a class="sourceLine" id="cb56-4" title="4"><span class="ex">2eb03e9</span> adds new line</a>
<a class="sourceLine" id="cb56-5" title="5"><span class="ex">85f4e33</span> initial commit</a></code></pre></div>
<p>このログから、</p>
<ul>
<li>newbranchとmasterというブランチは、c67341bというコミットを指している</li>
<li>HEADはnewbranchを指している</li>
</ul>
<p>ということがわかる。ブランチはコミットの別名であり、新しいブランチを作っただけでまだ何も作業をしていないため、現在はブランチは二つとも同じコミットを指している。ただし、HEADが<code>newbranch</code>を指しているため、今後の変更は<code>newbranch</code>に対して行われる。</p>
<p>この状態で、また<code>README.md</code>を修正しよう。最後の一行を追記して保存せよ。</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode txt"><code class="sourceCode default"><a class="sourceLine" id="cb57-1" title="1"># Test</a>
<a class="sourceLine" id="cb57-2" title="2"></a>
<a class="sourceLine" id="cb57-3" title="3">Hello git</a>
<a class="sourceLine" id="cb57-4" title="4">Bye git</a>
<a class="sourceLine" id="cb57-5" title="5">Git from VSCode</a>
<a class="sourceLine" id="cb57-6" title="6">modified at newbranch</a></code></pre></div>
<p>この状態でコミットしよう。</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb58-1" title="1"><span class="fu">git</span> ci -m <span class="st">&quot;modified at newbranch&quot;</span></a></code></pre></div>
<p>またログを見てみる。</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb59-1" title="1">$ <span class="fu">git</span> log --oneline</a>
<a class="sourceLine" id="cb59-2" title="2"><span class="ex">8f4db0d</span> (HEAD -<span class="op">&gt;</span> newbranch) <span class="ex">modified</span> at newbranch</a>
<a class="sourceLine" id="cb59-3" title="3"><span class="ex">c67341b</span> (master) <span class="ex">commit</span> from VSCode</a>
<a class="sourceLine" id="cb59-4" title="4"><span class="ex">e633552</span> modifies README.md</a>
<a class="sourceLine" id="cb59-5" title="5"><span class="ex">2eb03e9</span> adds new line</a>
<a class="sourceLine" id="cb59-6" title="6"><span class="ex">85f4e33</span> initial commit</a></code></pre></div>
<p>このログから</p>
<ul>
<li>新しいコミット(8f4db0d)が作成された</li>
<li><code>newbranch</code>は新しいコミットを指している</li>
<li><code>master</code>は古いコミット(c67341b)を指したまま</li>
<li><code>HEAD</code>は<code>newbranch</code>を指している</li>
</ul>
<p>ということがわかる。コミットすると歴史が増え、<code>HEAD</code>が指しているブランチが一緒に動く、と理解すると良い。</p>
<h3 id="マージ">マージ</h3>
<p>次に、<code>newbranch</code>で行った修正を<code>master</code>に反映しよう。ブランチを移動する。</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb60-1" title="1"><span class="fu">git</span> checkout master</a></code></pre></div>
<p>すると、VSCodeが表示する中身も古い状態に戻る。</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode txt"><code class="sourceCode default"><a class="sourceLine" id="cb61-1" title="1"># Test</a>
<a class="sourceLine" id="cb61-2" title="2"></a>
<a class="sourceLine" id="cb61-3" title="3">Hello git</a>
<a class="sourceLine" id="cb61-4" title="4">Bye git</a>
<a class="sourceLine" id="cb61-5" title="5">Git from VSCode</a></code></pre></div>
<p>この状態で<code>newbranch</code>の変更を<code>master</code>に反映させるには、<code>git merge</code>コマンドを使う。</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb62-1" title="1">$ <span class="fu">git</span> merge newbranch</a>
<a class="sourceLine" id="cb62-2" title="2"><span class="ex">Updating</span> c67341b..8f4db0d</a>
<a class="sourceLine" id="cb62-3" title="3"><span class="ex">Fast-forward</span></a>
<a class="sourceLine" id="cb62-4" title="4"> <span class="ex">README.md</span> <span class="kw">|</span> <span class="ex">1</span> +</a>
<a class="sourceLine" id="cb62-5" title="5"> <span class="ex">1</span> file changed, 1 insertion(+)</a></code></pre></div>
<p>VS Codeの表示が、先程修正したものに変わっていることを確認せよ。</p>
<p>ここで「Fast-forward」とあるのは、「<code>master</code>ブランチを移動させただけで、コミットは作成されていないよ」ということを意味する。ログを見てみよう。</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb63-1" title="1"><span class="ex">8f4db0d</span> (HEAD -<span class="op">&gt;</span> master, newbranch) <span class="ex">modified</span> at newbranch</a>
<a class="sourceLine" id="cb63-2" title="2"><span class="ex">c67341b</span> commit from VSCode</a>
<a class="sourceLine" id="cb63-3" title="3"><span class="ex">e633552</span> modifies README.md</a>
<a class="sourceLine" id="cb63-4" title="4"><span class="ex">2eb03e9</span> adds new line</a>
<a class="sourceLine" id="cb63-5" title="5"><span class="ex">85f4e33</span> initial commit</a></code></pre></div>
<p>先程とコミットの連なり(歴史)は全く変わっておらず、<code>master</code>の指す先がc67341bから8f4db0dに変わっただけなのがわかる。また、<code>HEAD</code>が<code>master</code>を指していることにも注意。原則としてGitでは、<code>HEAD</code>が指しているブランチに対して作業を行う。</p>
<p>不要になったブランチは消しておこう。</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb64-1" title="1">$ <span class="fu">git</span> branch -d newbranch</a>
<a class="sourceLine" id="cb64-2" title="2"><span class="ex">Deleted</span> branch newbranch (was 8f4db0d)<span class="ex">.</span></a></code></pre></div>
<h3 id="衝突">衝突</h3>
<p>さて、Gitは複数名で編集作業を行うためのツールなので、自分がなにかを修正してる際に、他の人が同じファイルを修正してしまった、ということがあるだろう。両方の修正を取り込むことができれば問題ないが、同じファイルの同じ場所を修正してしまった場合、どちらの修正をどのように取り込むかを決めなくてはならない。</p>
<p>このように、二つのブランチをマージしようとして、自動でマージできない状態を「衝突(conflict)」と呼ぶ。以下では、意図的に衝突を起こし、その修正をしてみよう。</p>
<p>まず、新しいブランチ<code>conflict</code>を作り、そちらに移動する。</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb65-1" title="1"><span class="fu">git</span> checkout -b conflict</a></code></pre></div>
<p>VSCodeで、最後にこんな行を付け加えよう。</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode txt"><code class="sourceCode default"><a class="sourceLine" id="cb66-1" title="1"># Test</a>
<a class="sourceLine" id="cb66-2" title="2"></a>
<a class="sourceLine" id="cb66-3" title="3">Hello git</a>
<a class="sourceLine" id="cb66-4" title="4">Bye git</a>
<a class="sourceLine" id="cb66-5" title="5">Git from VSCode</a>
<a class="sourceLine" id="cb66-6" title="6">modified at newbranch</a>
<a class="sourceLine" id="cb66-7" title="7">modified at conflict</a></code></pre></div>
<p>そしてコミットして、<code>master</code>に戻る。</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb67-1" title="1">$ <span class="fu">git</span> commit -a -m <span class="st">&quot;modified at conflict&quot;</span></a>
<a class="sourceLine" id="cb67-2" title="2">[<span class="ex">conflict</span> ab8cbff] modified at conflict</a>
<a class="sourceLine" id="cb67-3" title="3"> <span class="ex">1</span> file changed, 1 insertion(+)</a>
<a class="sourceLine" id="cb67-4" title="4"></a>
<a class="sourceLine" id="cb67-5" title="5">$ <span class="fu">git</span> checkout master</a>
<a class="sourceLine" id="cb67-6" title="6"><span class="ex">Switched</span> to branch <span class="st">&#39;master&#39;</span></a></code></pre></div>
<p>ここでは、新たに<code>ab8cbff</code>というコミットが作られたことがわかる。</p>
<p>さて、<code>master</code>でも同じ箇所を修正しよう。</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode txt"><code class="sourceCode default"><a class="sourceLine" id="cb68-1" title="1"># Test</a>
<a class="sourceLine" id="cb68-2" title="2"></a>
<a class="sourceLine" id="cb68-3" title="3">Hello git</a>
<a class="sourceLine" id="cb68-4" title="4">Bye git</a>
<a class="sourceLine" id="cb68-5" title="5">Git from VSCode</a>
<a class="sourceLine" id="cb68-6" title="6">modified at newbranch</a>
<a class="sourceLine" id="cb68-7" title="7">modified at master</a></code></pre></div>
<p>そしてコミットする。</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb69-1" title="1">$ <span class="fu">git</span> commit -a -m <span class="st">&quot;modified at master&quot;</span></a>
<a class="sourceLine" id="cb69-2" title="2">[<span class="ex">master</span> 2f3fb32] modified at master</a>
<a class="sourceLine" id="cb69-3" title="3"> <span class="ex">1</span> file changed, 1 insertion(+)</a></code></pre></div>
<p>新たに<code>2f3fb32</code>というコミットが作られた。</p>
<p>さて、もともと<code>8f4db0d</code>というコミットがあったのだが、ここから<code>ab8cbff</code>というコミットと<code>2f3fb32</code>というコミットが作られ、歴史が分岐した。ここで<code>conflict</code>ブランチで作業をしていたのを思い出し、マージを試みる。</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb70-1" title="1">$ <span class="fu">git</span> merge conflict</a>
<a class="sourceLine" id="cb70-2" title="2"><span class="ex">Auto-merging</span> README.md</a>
<a class="sourceLine" id="cb70-3" title="3"><span class="ex">CONFLICT</span> (content)<span class="bu">:</span> Merge conflict in README.md</a>
<a class="sourceLine" id="cb70-4" title="4"><span class="ex">Automatic</span> merge failed<span class="kw">;</span> <span class="ex">fix</span> conflicts and then commit the result.</a></code></pre></div>
<p>「自動でマージできず、衝突(conflict)したのでなんとかしてね」と言われている。この状態でstatusを見るとこうなる。</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb71-1" title="1">$ <span class="fu">git</span> status -s</a>
<a class="sourceLine" id="cb71-2" title="2"><span class="ex">UU</span> README.md</a></code></pre></div>
<p><code>UU</code>とあるのが衝突しているファイルだ。エディタで見るとこのように表示されるはず。</p>
<figure>
<img src="fig/vscode_conflict.png" alt="vscode conflict" /><figcaption>vscode conflict</figcaption>
</figure>
<p>ここで、どちらの修正を取り込むかを聞かれているので、適切なものを選ぶ。ここでは「両方の変更を取り込む」を選んでみよう。内容はこうなるはず。</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb72-1" title="1"><span class="co"># Test</span></a>
<a class="sourceLine" id="cb72-2" title="2"></a>
<a class="sourceLine" id="cb72-3" title="3"><span class="ex">Hello</span> git</a>
<a class="sourceLine" id="cb72-4" title="4"><span class="ex">Bye</span> git</a>
<a class="sourceLine" id="cb72-5" title="5"><span class="ex">Git</span> from VSCode</a>
<a class="sourceLine" id="cb72-6" title="6"><span class="ex">modified</span> at newbranch</a>
<a class="sourceLine" id="cb72-7" title="7"><span class="ex">modified</span> at master</a>
<a class="sourceLine" id="cb72-8" title="8"><span class="ex">modified</span> at conflict</a></code></pre></div>
<p>一般に、コードなどが衝突した場合は、どちらか(もしくは両方)を取り込むといった単純な対応ではうまくいかず、意図する動作になるように修正が必要なことが多いが、ここではこれで修正が済んだことにして、コミットしよう。Gitに「衝突が解決したよ」と伝えるには、<code>git add</code>を使う。</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb73-1" title="1"><span class="fu">git</span> add README.md</a></code></pre></div>
<p>この状態でコミットすると、分岐した歴史が一つに戻る。</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb74-1" title="1"><span class="fu">git</span> commit -m <span class="st">&quot;merged&quot;</span></a>
<a class="sourceLine" id="cb74-2" title="2">[<span class="ex">master</span> 91a8668] merged</a></code></pre></div>
<p>ログを見てみよう。</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb75-1" title="1">$ <span class="fu">git</span> log --oneline</a>
<a class="sourceLine" id="cb75-2" title="2"><span class="ex">91a8668</span> (HEAD -<span class="op">&gt;</span> master) <span class="ex">merged</span></a>
<a class="sourceLine" id="cb75-3" title="3"><span class="ex">2f3fb32</span> modified at master</a>
<a class="sourceLine" id="cb75-4" title="4"><span class="ex">ab8cbff</span> (conflict) <span class="ex">modified</span> at conflict</a>
<a class="sourceLine" id="cb75-5" title="5"><span class="ex">8f4db0d</span> modified at newbranch</a>
<a class="sourceLine" id="cb75-6" title="6"><span class="ex">c67341b</span> commit from VSCode</a>
<a class="sourceLine" id="cb75-7" title="7"><span class="ex">e633552</span> modifies README.md</a>
<a class="sourceLine" id="cb75-8" title="8"><span class="ex">2eb03e9</span> adds new line</a>
<a class="sourceLine" id="cb75-9" title="9"><span class="ex">85f4e33</span> initial commit</a></code></pre></div>
<p><code>master</code>で作ったコミット<code>2f3fb32</code>の後に、新たなコミット<code>91a8668</code>が作られていることがわかる。また、<code>conflict</code>ブランチが取り残されていることにも注意。<code>conflict</code>ブランチの世界線では、まだ<code>master</code>が新たにコミットを作っており、さらに自分の修正を取り込んだことを知らない。しかし、<code>master</code>ブランチの世界線では<code>conflict</code>ブランチの修正は取り込んであるため、もはや<code>conflict</code>ブランチは不要だ。消してしまおう。</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb76-1" title="1">$ <span class="fu">git</span> branch -d conflict</a>
<a class="sourceLine" id="cb76-2" title="2"><span class="ex">Deleted</span> branch conflict (was ab8cbff)<span class="ex">.</span></a></code></pre></div>
<p>マージ済みであることがわかっているブランチは、問題なく消すことができる。マージされていないブランチは「マージされていないよ」と警告が出て消すことができないので、マージするか、取り込まなくても良いことがわかっている場合は<code>git branch -D ブランチ名</code>で強制的に消すことができる。</p>
</article>
</body>
</html>

# Vimの使い方

## Vimとは

VimはVi IMprovedの略で、viというエディタを拡張したものだ。多くの環境で、単に`vi`とすると`vim`が起動する。以下、Vimのこともviと呼ぶことにする。viはUNIX-likeな環境において、Emacsと人気を二分するエディタである([エディタ戦争](https://ja.wikipedia.org/wiki/%E3%82%A8%E3%83%87%E3%82%A3%E3%82%BF%E6%88%A6%E4%BA%89)を参照)。本研究室ではリモートサーバにsshでログインして作業することが多くなる。この時、VSCodeなどをリモート接続してファイルを編集することも可能なのだが、せっかく数値計算の研究室に配属されたことだし、教養としてviとEmacsくらいは使えるようになっておこう。以下、私の趣味でviを使うが、簡単な操作くらいはどちらも使えるようになっておくのが望ましい。

Vimの使い方を解説したサイトは多数あるが、例えば

[はじめてのVim 〜 Vimはいいぞ！ゴリラと学ぶVim講座](https://knowledge.sakura.ad.jp/21687/)

等で学ぶと良いだろう。

## モードについて

Vimの最大の特徴はモードがあることだ。起動直後はノーマルモードとなっており、そのままでは入力ができない。`i`などを押すと入力モードとなり、文字が入力できるようになる。`ESC`を押すとノーマルモードに戻る。

また、`:`を押すことでコマンドラインモードになる。ここでは置換など様々なことができる。`v`などを押すことでビジュアルモードになり、テキストの一部分を選択したり、選択した範囲について操作ができる。

## カーソル移動と基本の編集

まず、適当なディレクトリで、新しいファイル`test.txt`をvimで開いてみよう。

```sh
vim test.txt
```

viの最大の特徴は「モード」を持つことだ。viには「ノーマルモード」と「編集モード」の二つのモードがあり、それを入れ替えながらファイルを編集する(他にもモードがあるが、深くは立ち入らない)。起動時には「ノーマルモード」になっており、そのままでは文字入力ができない。ここで「i」を押して編集モードに切り替えよう。

画面の下が`-- 挿入 -- `という表示になったはずだ。この状態では、通常のエディタのように文字列を入力することができる。

この状態で、`Hello vim!`と入力し、改行してからESCを押そう。

ESCを押したらノーマルモードになる。この状態では、キー入力によりコマンドやカーソル移動ができる。

### h,j,k,l

まずはhjklでカーソル移動ができる。それぞれ以下の通りだ。

* h 一文字左
* l 一文字右
* j 一行上
* k 一行下

### ^, $

Vimには他にも多くの移動方法がある。よく使うのが「`^`」と「`$`」だ。それぞれ

* `^` 行頭へ移動
* `$` 行末へ移動

である。

### gg, G

`gg`でファイルの先頭に、`G`でファイルの最後に移動できる。これも使用頻度が高いので覚えておきたい。

### w,e,b

「w, e, b」で単語単位の移動ができる。それぞれ

* w 次の単語の先頭へ移動
* e 単語の最後へ移動
* b 前の単語の先頭へ移動

となる。これらは「ピリオド、コンマ、エクスクラメーションマーク」といったマークを区別して移動する(マークを単語として扱う)が、大文字の「W, E, B」とするとマークを単語として扱わない。

### y,d,p

Vimでは「yy」でカーソルのある行を一行コピーできる(ヤンクと呼ぶ)。コピーした行は「p」で貼り付けることができる。`Hello Vim!`の行で「yyp」と入力せよ。

```txt
Hello Vim!
Hello Vim!
```

と二行になったはずだ。

Vimは、操作の前に数字を入力すると、その数だけ操作を繰り返す。上記の状態で「5p」と入力せよ。

```txt
Hello Vim!
Hello Vim!
Hello Vim!
Hello Vim!
Hello Vim!
Hello Vim!
Hello Vim!
```

「5 行 追加しました」の表示とともに上記のように行が増えたはずだ。

「dd」により行を一行削除できる。適当な行で「dd」と入力せよ。一行消え、「Hello Vim!」が6行になったはずだ。この状態で`gg`で一番上に行って、`5dd`と入力せよ。5行消えて、一行だけになったはずだ。

### u

`u`で直前の操作のアンドゥが出来る。`dd`で一行消して、`u`を押してみよう。操作が取り消されたはずだ。

### H, M, L

また「Hello Vim!」を増やそう。`yy`、`100p`で100行くらい追加した後、H, M, Lによる移動をためそう。それぞれ

* `H` 画面の一番上
* `M` 画面中央
* `L` 画面の一番下

### v

`v`を押すことでビジュアル選択モードになる。

* `gg`でファイルの先頭に移動
* `v` でビジュアル選択開始
* `G`でファイルの一番最後に移動
* `$`で行の最後に移動

により、全てを選択しよう。その後`d`により全て消して良い。

### `%`

`%`を押すと、対応する括弧に飛んでくれる。

```txt
((()))
```

と入力し、適当な括弧で`%`を押してみよ。カーソルが対応する括弧に飛ぶ。これはC/C++など、ブロックを括弧で作るプログラムを組む時に便利だ。

### Ctrl+v

`v`で行単位の選択ができたが、`Ctrl+v`で矩形選択ができる。

以下の文章を作成せよ。

```txt
* Hello Vim!
* Hello Vim!
* Hello Vim!
* Hello Vim!
* Hello Vim!
```

このうち、Helloだけ消したくなったとする。置換でもできるが、最初のHelloの冒頭にカーソルを移動し、`Ctrl+v`で矩形選択開始、その後、最後のHelloの単語末まで移動して`d`。これでHelloが消えた。

### Ctrl+a, Ctrl+x

カーソル位置にある数字を増減できる。

```py
print(a[1])
```

と入力し、1のところにカーソルを合わせてCtrl+aやCtrl+xを押してみよ。数字が増減するはずだ。

これを利用して面白いことができる。

まず

```txt
1
```

とだけ書いて、これを100行くらいコピーしよう。そのあと、「2行目」から最後までを`v`で選択してから`g` `Ctrl+a`と入力せよ。

```txt
1
2
3
(snip)
101
```

と連番になったはずだ。

### :数字

`:`を押すとコマンドモードになるが、そこで数字を入力すると行ジャンプができる。`:50`と入力してリターンを押してみよ。50行目に飛ぶはずだ。

### Ctrl+f/b/e/y

`Ctrl`と`f, b, e, y`で画面移動ができる。

* `Ctrl+f` 一画面下に移動 (forward)
* `Ctrl+b` 一画面上に移動 (back)
* `Ctrl+e` 一行上に移動(カーソルそのまま)
* `Ctrl+y` 一行下に移動(カーソルそのまま)

### J, gJ

`J`で次の行をまとめることができる。ただし、空白が入る。空白を入れたくなければ`gJ`とする。`v`によるビジュアル選択を組み合わせるとたまに便利。

## 検索・置換

* `/`で検索ができる。`:nohlsearch`で検索のハイライトが消える。
* `:set incsearch`でインクリメンタルサーチが、`:set noincsearch`で元に戻せる。

```cpp
p[X] = p[X] + q[X] * h;
```

`:%s/X/Y/g`と入力して、`X`を`Y`に


* :%s/X/Y/g
* :%s/X/Y/gc
* :'<,'>/X/Y/g
